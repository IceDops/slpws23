<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Model
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Model";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/custom.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (M)</a> &raquo;
    
    
    <span class="title">Model</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Model
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>model.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_medium-instance_method" title="#create_medium (instance method)">#<strong>create_medium</strong>(db, medium)  &#x21d2; Number </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a medium in the database and saves the image.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_review-instance_method" title="#create_review (instance method)">#<strong>create_review</strong>(db, media_id, user_id, rating, desc)  &#x21d2; Number </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Inserts a newly created review into the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_user-instance_method" title="#create_user (instance method)">#<strong>create_user</strong>(db, username, password, password_confirmation)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#database-instance_method" title="#database (instance method)">#<strong>database</strong>(path)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_review-instance_method" title="#delete_review (instance method)">#<strong>delete_review</strong>(db, media_id, review_id)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Deletes specifed review in the database provided.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#display_error-instance_method" title="#display_error (instance method)">#<strong>display_error</strong>(status, msg)  &#x21d2; Nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Displays an error site customized with the error provided.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#does_review_exist-instance_method" title="#does_review_exist (instance method)">#<strong>does_review_exist</strong>(db, media_id, review_id)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if review ID exist and belongs belongs to a certain media in the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#does_user_exist-instance_method" title="#does_user_exist (instance method)">#<strong>does_user_exist</strong>(db, username)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if a user with the specified username exist in the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#does_user_have_review-instance_method" title="#does_user_have_review (instance method)">#<strong>does_user_have_review</strong>(db, user_id, media_id)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if user has already published a review for a specific media.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#followings_reviews-instance_method" title="#followings_reviews (instance method)">#<strong>followings_reviews</strong>(db, user_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_all_media-instance_method" title="#get_all_media (instance method)">#<strong>get_all_media</strong>(db)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_all_reviews-instance_method" title="#get_all_reviews (instance method)">#<strong>get_all_reviews</strong>(db, media_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#media-instance_method" title="#media (instance method)">#<strong>media</strong>(db, media_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#review-instance_method" title="#review (instance method)">#<strong>review</strong>(db, review_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_rating-instance_method" title="#update_rating (instance method)">#<strong>update_rating</strong>(db, media_id)  &#x21d2; Nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculates a total rating for a medium based on user reviews and updates the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_review-instance_method" title="#update_review (instance method)">#<strong>update_review</strong>(db, media_id, review_id, updated_review)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates the specified review in the database provided with provided information.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#user_reviews-instance_method" title="#user_reviews (instance method)">#<strong>user_reviews</strong>(db, user_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#users-instance_method" title="#users (instance method)">#<strong>users</strong>(db, user_ids)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create_medium-instance_method">
  
    #<strong>create_medium</strong>(db, medium)  &#x21d2; <tt>Number</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a medium in the database and saves the image</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>SQLite3::Database</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>where review is s</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>medium to be created</p>
<ul><li>
<p>:name [String] the medium name</p>
</li><li>
<p>:type [String] the medium type (book, song, etc.)</p>
</li><li>
<p>:creation_date [Number] the unix timestamp for the mediums creation date</p>
</li><li>
<p>:authors [Array&lt;String&gt;] the original authors of the medium</p>
</li><li>
<p>:genres [Array&lt;String&gt;] the genres belonging to the medium</p>
</li><li>
<p>:img_file [Hash] the hash of the img file. It has the structure of a uploaded file through a HTMl form.</p>
</li></ul>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id of the newly created medium</p>
</div>
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 308</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_medium'>create_medium</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_medium'>medium</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>./public/img/uploaded_img/media</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:img_file</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The path to the uploaded file: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The supposed tempfile: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:img_file</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:tempfile</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:img_file</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:tempfile</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO Media (name, total_rating, type, creation_date, picpath) VALUES (?, ?, ?, ?, ?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='kw'>nil</span><span class='comma'>,</span>
        <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:creation_date</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:img_file</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:filename</span><span class='rbracket'>]</span>
    <span class='rparen'>)</span>

    <span class='id identifier rubyid_media_id'>media_id</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_last_insert_row_id'>last_insert_row_id</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:authors</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_author'>author</span><span class='op'>|</span>
        <span class='id identifier rubyid_author_id'>author_id</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT id FROM Author WHERE name = ? </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_author'>author</span><span class='rparen'>)</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_author_id'>author_id</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO Author (name) VALUES (?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_author'>author</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_author_id'>author_id</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_last_insert_row_id'>last_insert_row_id</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AUTHOR ID: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_author_id'>author_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

        <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO Media_author_relation (author_id, media_id) VALUES (?, ?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='id identifier rubyid_author_id'>author_id</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
            <span class='id identifier rubyid_media_id'>media_id</span>
        <span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='symbol'>:genres</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_genre'>genre</span><span class='op'>|</span>
        <span class='id identifier rubyid_genre_id'>genre_id</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM Genre WHERE name = ? </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_genre'>genre</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_genre_id'>genre_id</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO Genre (name) VALUES (?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_genre'>genre</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_genre_id'>genre_id</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_last_insert_row_id'>last_insert_row_id</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO Media_genre_relation (genre_id, media_id) VALUES (?, ?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='id identifier rubyid_genre_id'>genre_id</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
            <span class='id identifier rubyid_media_id'>media_id</span>
        <span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_media_id'>media_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_review-instance_method">
  
    #<strong>create_review</strong>(db, media_id, user_id, rating, desc)  &#x21d2; <tt>Number</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Inserts a newly created review into the database</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>SQLite3::Database</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>where review is stored</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the media id belonging to the review in the database</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>review’s id in the dat</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the id of the newly created revi ew</p>
</div>
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


267
268
269
270
271
272
273
274
275
276
277
278
279</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 267</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_review'>create_review</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_rating'>rating</span><span class='comma'>,</span> <span class='id identifier rubyid_desc'>desc</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>USER IS SITLL </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_id'>user_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User review already exist for this media.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_does_user_have_review'><span class='object_link'><a href="#does_user_have_review-instance_method" title="Model#does_user_have_review (method)">does_user_have_review</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSERT INTO Review (media_id, user_id, rating, content, creation_date) VALUES (?, ?, ?, ?, ?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
        <span class='id identifier rubyid_media_id'>media_id</span><span class='comma'>,</span>
        <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span>
        <span class='id identifier rubyid_rating'>rating</span><span class='comma'>,</span>
        <span class='id identifier rubyid_desc'>desc</span><span class='comma'>,</span>
        <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_last_insert_row_id'>last_insert_row_id</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_user-instance_method">
  
    #<strong>create_user</strong>(db, username, password, password_confirmation)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


360
361
362
363
364
365
366</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 360</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_user'>create_user</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_password_confirmation'>password_confirmation</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A user with the provided username does already exist.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_does_user_exist'><span class='object_link'><a href="#does_user_exist-instance_method" title="Model#does_user_exist (method)">does_user_exist</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_username'>username</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Passwords does not match.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_password'>password</span> <span class='op'>!=</span> <span class='id identifier rubyid_password_confirmation'>password_confirmation</span>

     
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="database-instance_method">
  
    #<strong>database</strong>(path)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 49</span>

<span class='kw'>def</span> <span class='id identifier rubyid_database'>database</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='const'>SQLite3</span><span class='op'>::</span><span class='const'>Database</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>db/main.db</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_results_as_hash'>results_as_hash</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_db'>db</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_review-instance_method">
  
    #<strong>delete_review</strong>(db, media_id, review_id)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Deletes specifed review in the database provided</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>SQLite3::Database</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>where review is stored</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the media id belonging to the review in the database</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>review’s id in the database</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>was it deleted?</p>
</div>
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253
254
255
256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 251</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_review'>delete_review</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_does_review_exist'><span class='object_link'><a href="#does_review_exist-instance_method" title="Model#does_review_exist (method)">does_review_exist</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DELETE FROM Review WHERE id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="display_error-instance_method">
  
    #<strong>display_error</strong>(status, msg)  &#x21d2; <tt>Nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Displays an error site customized with the error provided</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>HTTP response status code the error is going to have</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>error message that will be displayed</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Nil</tt>)</span>
      
      
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 107</span>

<span class='kw'>def</span> <span class='id identifier rubyid_display_error'>display_error</span><span class='lparen'>(</span><span class='id identifier rubyid_status'>status</span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_slim'>slim</span><span class='lparen'>(</span><span class='symbol'>:&quot;error&quot;</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>document_title:</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='label'>error_message:</span> <span class='id identifier rubyid_msg'>msg</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="does_review_exist-instance_method">
  
    #<strong>does_review_exist</strong>(db, media_id, review_id)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if review ID exist and belongs belongs to a certain media in the database</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>SQLite3::Database</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>where review is stored</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>media’s id in the database</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>review’s id in the database</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if it exist</p>
</div>
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_does_review_exist'>does_review_exist</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_review'><span class='object_link'><a href="#review-instance_method" title="Model#review (method)">review</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_review'><span class='object_link'><a href="#review-instance_method" title="Model#review (method)">review</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_review'><span class='object_link'><a href="#review-instance_method" title="Model#review (method)">review</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='id identifier rubyid_media_id'>media_id</span> <span class='op'>=</span> <span class='op'>!</span><span class='id identifier rubyid_review'><span class='object_link'><a href="#review-instance_method" title="Model#review (method)">review</a></span></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>media_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="does_user_exist-instance_method">
  
    #<strong>does_user_exist</strong>(db, username)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if a user with the specified username exist in the database</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>SQLite3::Database</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>where review is stored</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>username that is going to be checked</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if it exist</p>
</div>
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 95</span>

<span class='kw'>def</span> <span class='id identifier rubyid_does_user_exist'>does_user_exist</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_username'>username</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT id FROM User WHERE name = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_username'>username</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="does_user_have_review-instance_method">
  
    #<strong>does_user_have_review</strong>(db, user_id, media_id)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if user has already published a review for a specific media</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>SQLite3::Database</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>where review is stored</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>media’s id in the database</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ID belongning to the user that is being checked</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if it exist</p>
</div>
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_does_user_have_review'>does_user_have_review</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Does user already have review?</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_user_reviews'><span class='object_link'><a href="#user_reviews-instance_method" title="Model#user_reviews (method)">user_reviews</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM Review WHERE user_id = ? AND media_id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_user_reviews'><span class='object_link'><a href="#user_reviews-instance_method" title="Model#user_reviews (method)">user_reviews</a></span></span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>USER </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_id'>user_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> DOES NOT HAVE REVIEWS</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="followings_reviews-instance_method">
  
    #<strong>followings_reviews</strong>(db, user_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205
206
207
208
209
210
211
212
213
214
215</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 203</span>

<span class='kw'>def</span> <span class='id identifier rubyid_followings_reviews'>followings_reviews</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_followings'>followings</span> <span class='op'>=</span> <span class='id identifier rubyid_users'><span class='object_link'><a href="#users-instance_method" title="Model#users (method)">users</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:following_ids</span><span class='rbracket'>]</span>

    <span class='comment'>#print(&quot;Followings: &quot;)
</span>    <span class='comment'>#print(followings)
</span>
    <span class='id identifier rubyid_followings_reviews'>followings_reviews</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_followings'>followings</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_following'>following</span><span class='op'>|</span> <span class='id identifier rubyid_followings_reviews'>followings_reviews</span> <span class='op'>=</span> <span class='id identifier rubyid_followings_reviews'>followings_reviews</span> <span class='op'>+</span> <span class='id identifier rubyid_user_reviews'><span class='object_link'><a href="#user_reviews-instance_method" title="Model#user_reviews (method)">user_reviews</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_following'>following</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_followings_reviews'>followings_reviews</span> <span class='op'>=</span> <span class='id identifier rubyid_followings_reviews'>followings_reviews</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_review'><span class='object_link'><a href="#review-instance_method" title="Model#review (method)">review</a></span></span><span class='op'>|</span> <span class='id identifier rubyid_review'><span class='object_link'><a href="#review-instance_method" title="Model#review (method)">review</a></span></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>creation_date</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='op'>-</span><span class='int'>1</span> <span class='rbrace'>}</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_followings_reviews'>followings_reviews</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_all_media-instance_method">
  
    #<strong>get_all_media</strong>(db)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 159</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_all_media'>get_all_media</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_media'><span class='object_link'><a href="#media-instance_method" title="Model#media (method)">media</a></span></span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM Media</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_media'><span class='object_link'><a href="#media-instance_method" title="Model#media (method)">media</a></span></span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_media_return'>media_return</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_media'><span class='object_link'><a href="#media-instance_method" title="Model#media (method)">media</a></span></span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_medium'>medium</span><span class='op'>|</span>
        <span class='id identifier rubyid_media_return'>media_return</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_medium'>medium</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_genres'>genres</span> <span class='op'>=</span>
            <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT Genre.id FROM Genre INNER JOIN Media_genre_relation ON Genre.id = Media_genre_relation.genre_id WHERE Media_genre_relation.media_id = ?;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
            <span class='rparen'>)</span>
        <span class='id identifier rubyid_authors'>authors</span> <span class='op'>=</span>
            <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT Author.id FROM Author INNER JOIN Media_author_relation ON Author.id = Media_author_relation.author_id WHERE Media_author_relation.media_id = ?;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                <span class='id identifier rubyid_medium'>medium</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
            <span class='rparen'>)</span>
        <span class='id identifier rubyid_media_return'>media_return</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:genre_ids</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_genres'>genres</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_genre'>genre</span><span class='op'>|</span> <span class='id identifier rubyid_genre'>genre</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_media_return'>media_return</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:author_ids</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_authors'>authors</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_author'>author</span><span class='op'>|</span> <span class='id identifier rubyid_author'>author</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_media_return'>media_return</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_all_reviews-instance_method">
  
    #<strong>get_all_reviews</strong>(db, media_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191
192
193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_all_reviews'>get_all_reviews</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_reviews'>reviews</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM Review WHERE Review.media_id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_reviews'>reviews</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='id identifier rubyid_reviews'>reviews</span> <span class='op'>=</span> <span class='id identifier rubyid_reviews'>reviews</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_review'><span class='object_link'><a href="#review-instance_method" title="Model#review (method)">review</a></span></span><span class='op'>|</span> <span class='id identifier rubyid_review'><span class='object_link'><a href="#review-instance_method" title="Model#review (method)">review</a></span></span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>creation_date</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='op'>-</span><span class='int'>1</span> <span class='rbrace'>}</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_reviews'>reviews</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="media-instance_method">
  
    #<strong>media</strong>(db, media_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 138</span>

<span class='kw'>def</span> <span class='id identifier rubyid_media'>media</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sought_media'>sought_media</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM Media WHERE Media.id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_sought_media'>sought_media</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_genres'>genres</span> <span class='op'>=</span>
        <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT Genre.id FROM Genre INNER JOIN Media_genre_relation ON Genre.id = Media_genre_relation.genre_id WHERE Media_genre_relation.media_id = ?;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='id identifier rubyid_media_id'>media_id</span>
        <span class='rparen'>)</span>
    <span class='id identifier rubyid_authors'>authors</span> <span class='op'>=</span>
        <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT Author.id FROM Author INNER JOIN Media_author_relation ON Author.id = Media_author_relation.author_id WHERE Media_author_relation.media_id = ?;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='id identifier rubyid_media_id'>media_id</span>
        <span class='rparen'>)</span>

    <span class='id identifier rubyid_sought_media_return'>sought_media_return</span> <span class='op'>=</span> <span class='id identifier rubyid_sought_media'>sought_media</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='comment'># .map is syntactic sugar for extracting each id property out of the array of genre/author hashes
</span>    <span class='id identifier rubyid_sought_media_return'>sought_media_return</span><span class='lbracket'>[</span><span class='symbol'>:genre_ids</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_genres'>genres</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_genre'>genre</span><span class='op'>|</span> <span class='id identifier rubyid_genre'>genre</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_sought_media_return'>sought_media_return</span><span class='lbracket'>[</span><span class='symbol'>:author_ids</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_authors'>authors</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_author'>author</span><span class='op'>|</span> <span class='id identifier rubyid_author'>author</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_sought_media_return'>sought_media_return</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="review-instance_method">
  
    #<strong>review</strong>(db, review_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_review'>review</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sought_review'>sought_review</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM Review WHERE Review.id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_sought_review'>sought_review</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_sought_review'>sought_review</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_rating-instance_method">
  
    #<strong>update_rating</strong>(db, media_id)  &#x21d2; <tt>Nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculates a total rating for a medium based on user reviews and updates the database</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>SQLite3::Database</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>where review is stored</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>id of the media that is updated</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Nil</tt>)</span>
      
      
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289
290
291
292
293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 287</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_rating'>update_rating</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ratings'>ratings</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT rating FROM Review WHERE media_id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ratings_sum'>ratings_sum</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_ratings'>ratings</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_rating'>rating</span><span class='op'>|</span> <span class='id identifier rubyid_ratings_sum'>ratings_sum</span> <span class='op'>+=</span> <span class='id identifier rubyid_rating'>rating</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rating</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_average'>average</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_ratings_sum'>ratings_sum</span> <span class='op'>/</span> <span class='id identifier rubyid_ratings'>ratings</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UPDATE Media SET total_rating = ? WHERE id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_average'>average</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_review-instance_method">
  
    #<strong>update_review</strong>(db, media_id, review_id, updated_review)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates the specified review in the database provided with provided information</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>SQLite3::Database</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>where review is stored</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the media id belonging to the review in the database</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>review’s id in the database</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>update review</p>
<ul><li>
<p>:edited_review_rating [Number] the new review rating</p>
</li><li>
<p>:edited_review_desc [String] the new review description</p>
</li></ul>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>was it updated?</p>
</div>
      
    </li>
  
</ul>



</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 227</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_review'>update_review</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='comma'>,</span> <span class='id identifier rubyid_updated_review'>updated_review</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_does_review_exist'><span class='object_link'><a href="#does_review_exist-instance_method" title="Model#does_review_exist (method)">does_review_exist</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_media_id'>media_id</span><span class='comma'>,</span> <span class='id identifier rubyid_review_id'>review_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UPDATE Review
            SET content = ?, rating = ?, creation_date = ? 
            WHERE id = ?; </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='id identifier rubyid_updated_review'>updated_review</span><span class='lbracket'>[</span><span class='symbol'>:edited_review_desc</span><span class='rbracket'>]</span><span class='comma'>,</span>
            <span class='id identifier rubyid_updated_review'>updated_review</span><span class='lbracket'>[</span><span class='symbol'>:edited_review_rating</span><span class='rbracket'>]</span><span class='comma'>,</span>
            <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span>
            <span class='id identifier rubyid_review_id'>review_id</span>
        <span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>true</span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="user_reviews-instance_method">
  
    #<strong>user_reviews</strong>(db, user_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


197
198
199
200
201</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 197</span>

<span class='kw'>def</span> <span class='id identifier rubyid_user_reviews'>user_reviews</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_print'>print</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_reviews'>reviews</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM Review WHERE Review.user_id = ?;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_reviews'>reviews</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="users-instance_method">
  
    #<strong>users</strong>(db, user_ids)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'model.rb', line 111</span>

<span class='kw'>def</span> <span class='id identifier rubyid_users'>users</span><span class='lparen'>(</span><span class='id identifier rubyid_db'>db</span><span class='comma'>,</span> <span class='id identifier rubyid_user_ids'>user_ids</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_user_ids'>user_ids</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user_id'>user_id</span><span class='op'>|</span>
        <span class='id identifier rubyid_sought_user'>sought_user</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM User WHERE User.id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_sought_user'>sought_user</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

        <span class='id identifier rubyid_followings'>followings</span> <span class='op'>=</span>
            <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT User.id FROM User INNER JOIN User_follow_relation ON User.id = User_follow_relation.user_follows_this_id WHERE User_follow_relation.user_id = ?;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                <span class='id identifier rubyid_user_id'>user_id</span>
            <span class='rparen'>)</span>
        <span class='id identifier rubyid_followers'>followers</span> <span class='op'>=</span>
            <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT User.id FROM User INNER JOIN User_follow_relation ON User.id = User_follow_relation.user_id WHERE User_follow_relation.user_follows_this_id = ?;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                <span class='id identifier rubyid_user_id'>user_id</span>
            <span class='rparen'>)</span>

        <span class='id identifier rubyid_sought_user_complete'>sought_user_complete</span> <span class='op'>=</span> <span class='id identifier rubyid_sought_user'>sought_user</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
        <span class='comment'># .map is syntactic sugar for extracting each id property out of the array of following/follower hashes
</span>        <span class='id identifier rubyid_sought_user_complete'>sought_user_complete</span><span class='lbracket'>[</span><span class='symbol'>:following_ids</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_followings'>followings</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_following'>following</span><span class='op'>|</span> <span class='id identifier rubyid_following'>following</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_sought_user_complete'>sought_user_complete</span><span class='lbracket'>[</span><span class='symbol'>:follower_ids</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_followers'>followers</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_follower'>follower</span><span class='op'>|</span> <span class='id identifier rubyid_follower'>follower</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_sought_user_complete'>sought_user_complete</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_users'>users</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Apr 10 00:49:57 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.1.2).
</div>

    </div>
  </body>
</html>